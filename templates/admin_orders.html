{% extends "base.html" %}
{% block title %}Admin - Stickerdom{% endblock %}
{% block content %}
<div class="container mt-5 p-4 bg-light shadow-sm rounded"> 
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Morning, sir!</h1>
    </div>
    {%if orders%}
    <section class="admin-orders-list">
    <ul class="list-group">
        {% for order in orders%}
        <li class="list-group-item p-3"> 
            <div class="row align-items-center">
                <div class="col-md-2 fw-bold">
                    Order #{{order.id}}
                </div>

                <div class="col-md-3">
                    <span class="badge text-dark
                        {% if order.status == 'finished' %}bg-success
            {% elif order.status == 'cancelled' %}bg-danger
            {% elif order.status == 'confirmed' %}bg-primary
            {% elif order.status == 'pending' %}bg-warning text-dark
            {% endif %}">
            {{order.status}}</span>
                    <small class="text-muted d-block">{{ order.created_at.strftime('%d %b %Y %H:%M')}}</small>
                </div>

                <div class="col-md-2 fw-bold">
                    €{{ '%.2f'|format(order.total_price)}}
                </div>
                <div class="col-md-5 text-end">

                    {% set statuses = {
                        'pending': 'warning',
                        'confirmed': 'blue',
                        'finished': 'success',
                        'cancelled': 'danger'
                    } %}

                    {% for status, color in statuses.items() %}
                    <form method="POST"
                        action="{{ url_for('admin.update_order_status', order_id=order.id, new_status=status) }}"
                        class="d-inline">

                        <button
                            class="btn btn-sm
                                {% if order.status == status %}
                                    btn-{{ color }}
                                {% else %}
                                    btn-outline-{{ color }}
                                {% endif %}">
                            {{ status.capitalize() }}
                        </button>

                    </form>
                    {% endfor %}



                    <button class="btn btn-light rounded-circle ms-2"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#orderDetail{{ order.id }}"
                            aria-expanded="false">
                        <i class="bi bi-caret-down-fill"></i>
                </button>
                </div>
            </div>

            <div class="collapse mt-3" id="orderDetail{{ order.id }}">
                <div class="card card-body bg-light border-0">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Customer Details</h6>
                            <p class="mb-0">{{order.user_id}}</p>
                            <small class="text-muted">Stickerstraat 12, Amsterdam</small>
                        </div>
                        <div class="col-md-6">
                            <h6>Order contents</h6>
                            <ul class="list-unstyled">
                                {%for item in order.order_items%}
                                <li class="d-flex justify-content-between">
                                    <span>{{ item.sticker.name }} * {{ item.quantity }}</span>
                                    <span>€{{ '%.2f'|format(item.price_at_time * item.quantity) }}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </li>
        {% endfor %}
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-inbox text-muted display-1"></i>
            <h4 class="mt-3">No orders found</h4>
            <p class="text-muted mt-2 fs-5">There are currently no orders to display.</p>
        </div>
        
        {% endif %}

    
    </ul>
    </div>
    </section>

{% endblock %}


    